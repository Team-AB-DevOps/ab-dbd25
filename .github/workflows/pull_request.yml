name: Pull request

permissions:
  actions: write
  pull-requests: write
  deployments: write
  contents: write

on:
  pull_request:

jobs:
  terraform-changes:
    runs-on: ubuntu-latest
    outputs:
      changes: ${{steps.filter.outputs.changes}}
    steps:
      - uses: actions/checkout@v4
      - uses: dorny/paths-filter@v3
        id: filter
        with:
          filters: |
            terraform:
              - 'terraform/**'

  terraform-plan:
    needs: terraform-changes
    if: needs.terraform-changes.outputs.changes != '[]'
    uses: ./.github/workflows/terraform-plan.yml
    secrets:
      HCLOUD_TOKEN: ${{ secrets.HCLOUD_TOKEN }}
